# 路由系统实现教程

## 1. 基础路由配置

### 1.1 创建路由实例
```typescript
// src/router/index.ts
import { createRouter, createWebHashHistory } from 'vue-router'
import type { RouteRecordRaw } from 'vue-router'

const routes: RouteRecordRaw[] = [
  {
    path: '/',
    component: () => import('@/views/home/index.vue'),
    meta: { title: '首页' }
  }
]

const router = createRouter({
  history: createWebHashHistory(),
  routes
})

export default router
```

### 1.2 路由模块化
```typescript
// src/router/modules/system.ts
export default {
  path: '/system',
  component: () => import('@/layout/index.vue'),
  meta: { title: '系统管理' },
  children: [
    {
      path: 'user',
      component: () => import('@/views/system/user.vue'),
      meta: { title: '用户管理' }
    }
  ]
} as RouteRecordRaw
```

## 2. 动态路由实现

### 2.1 路由类型定义
```typescript
// src/types/router.d.ts
declare module 'vue-router' {
  interface RouteMeta {
    title?: string
    icon?: string
    roles?: string[]
  }
}
```

### 2.2 动态路由加载
```typescript
// src/router/index.ts
export function addRoutes(routes: RouteRecordRaw[]) {
  routes.forEach(route => {
    router.addRoute(route)
  })
}
```

## 3. 路由守卫

### 3.1 权限验证
```typescript
// src/permission.ts
router.beforeEach(async (to, from, next) => {
  const hasToken = getToken()
  
  if (hasToken) {
    if (to.path === '/login') {
      next('/')
    } else {
      const hasRoles = store.getters.roles?.length > 0
      if (hasRoles) {
        next()
      } else {
        try {
          const { roles } = await store.dispatch('user/getInfo')
          const accessRoutes = await store.dispatch('permission/generateRoutes', roles)
          addRoutes(accessRoutes)
          next({ ...to, replace: true })
        } catch (error) {
          next(`/login?redirect=${to.path}`)
        }
      }
    }
  } else {
    next('/login')
  }
})
```

## 4. 路由使用

### 4.1 路由跳转
```typescript
import { useRouter } from 'vue-router'

const router = useRouter()
router.push('/system/user')
```

### 4.2 获取路由信息
```typescript
import { useRoute } from 'vue-router'

const route = useRoute()
console.log(route.meta.title)
```

## 5. 常见问题

### 5.1 动态路由刷新丢失
解决方案：在路由守卫中重新添加路由

### 5.2 路由重复导航
检查点：
1. 确保next()只调用一次
2. 检查重定向逻辑