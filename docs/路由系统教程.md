# 路由系统详细教程

## 1. 功能概述
- 模块化路由配置
- 动态路由加载
- 路由导航守卫
- 路由元信息管理
- 嵌套路由支持

## 2. 核心代码解析

### 2.1 路由初始化
```typescript
// src/router/index.ts
const router = createRouter({
  history: createWebHashHistory(),
  routes: constantRoutes // 基础路由
})
```

### 2.2 动态路由添加
```typescript
// src/permission.ts
router.addRoute(accessedRoute) // 动态添加路由
```

### 2.3 路由守卫
```typescript
// src/permission.ts
router.beforeEach(async (to, from, next) => {
  // 权限验证逻辑
  if (hasToken()) {
    if (to.path === '/login') {
      next('/')
    } else {
      // 动态添加路由
      const { roles } = await store.dispatch('user/getInfo')
      const accessRoutes = await store.dispatch('permission/generateRoutes', roles)
      accessRoutes.forEach(route => router.addRoute(route))
      next({ ...to, replace: true })
    }
  } else {
    next('/login')
  }
})
```

## 3. 使用示例

### 3.1 路由配置
```typescript
// src/router/modules/system.ts
export default {
  path: '/system',
  component: Layout,
  meta: { title: '系统管理', icon: 'system' },
  children: [
    {
      path: 'user',
      component: () => import('@/views/system/user'),
      meta: { title: '用户管理' }
    }
  ]
}
```

### 3.2 路由元信息使用
```vue
<script setup>
import { useRoute } from 'vue-router'

const route = useRoute()
document.title = route.meta.title
</script>
```

## 4. 最佳实践
1. 路由按功能模块拆分
2. 路由懒加载优化性能
3. 路由元信息统一管理
4. 导航守卫逻辑清晰

## 5. 常见问题
Q: 动态路由刷新后丢失？
A: 需要在路由守卫中重新添加

Q: 路由跳转重复？
A: 检查导航守卫的next()调用